Описание многопотокового анализа

----------------------------------------------------

Для анализа сырых и/или декодированных данных используется буфер
GLBuf. Реально создается в памяти буфер GLBuf2, а GLBuf - это часть
GLBuf2, сдвинутая от начала на величину gl_off.

Размер буфера GLBuf2  =gl_sz+gl_off.

gl_sz = 1024*MAXTRANS2*gl_Nbuf - для DAQ
gl_sz = 1024*gl_Nbuf           - для анализа файла

gl_Nbuf=opt.nthreads - для многопотокового анализа
gl_Nbuf=8            - для однопотокового анализа

MAXTRANS2 - количество трансферов USB3. В romana всегда равно 7.

gl_off = 1 MB - размер офсета (сдвига) GLBuf относительно GLBuf2
Предполагается, что в офсет всегда поместится "хвост" от импульса
любой разрешенной длины.

Разрешенные для использования области памяти для GLBuf2 и GLBuf:

GLBuf2:  0        ..  gl_sz+gl_off
GLBuf :  -gl_off  ..  gl_sz

----------------------------------------------------
Обработка данных в многопотоковом режиме для DAQ:

Данные поступают из USB3 порциями (транферами), организованными в
очередь. Размер одного трансфера и размер "кольца трансферов" задается
перед началом накопления (при нажатии кнопки "Start"). "Кольцо
трансферов" состоит из N трансферов, следующих один за другим. При
достижении максимального трансфера кольцо переходит на нулевой. Для
линукса максимально работающая комбинация "Размер одного трансфера -
размер кольца трансферов": 1МБ - 8 или 2МБ -7. При размере трансфера
2МБ и размере "кольца трансферов" 8 ничего не работает по непонятной
причине. В программе romana размер "кольца трансферов" всегда 7.

Данные из USB3 "появляются" в процедуре cback в структуре trans. Это
происходит либо если буфер соответствующего трансфера полностью
заполнился, либо при остановке трансферов (тогда размер буфера будет
неполным). В trans->user_data записан номер текущего трансфера. Номера
всегда следуют строго по порядку: 0 -> 1 -> 2 .. -> 6 -> 0 -> 1 ->
... Случаев, когда порядок следования трансферов сбивался, не
наблюдалось никогда.



Размер буфера GLBuf - gl_sz.


Данные считываются в буфер GLBuf.

sdadgdg sdfgsdg sdfgdsf dsfg dfg sdfg sdg sdfg df gdf dfgsdf dfgsdfgd sdfgsdfg dsfgsdfg dfgd sdfsdfg sdfg sdfg sfg dfgsdf sdfg sdfg sdfg dfg sdfg sdfg d sg sdfgjhkjh gjhg jhg jhg jhgj hgiuy jhg jgnmh uykj jyjghg
dfgsdfg
sdfgdsfg
